<!DOCTYPE html>
<html>
<head>
  <script src="https://unpkg.com/backendless"></script>
</head>
<body>
  <script>
    const APP_ID = "YOUR-BACKENDLESS-APP-ID";
    const SUBSCRIBE_API_KEY = "YOUR-SUBSCRIBE-API-KEY";

    async function subscribeToChannel(channelName, token) {
      try {
        console.log("üß™ Backendless script starting...");

        // Step 1: Init Backendless FIRST
        Backendless.initApp(APP_ID, SUBSCRIBE_API_KEY);
        console.log("‚úÖ Backendless initialized");

        // Step 2: Set current user token
        Backendless.UserService.setCurrentUserToken(token);
        console.log("üîë Token set:", token);

        // Step 3: Subscribe to the real-time channel
        const rt = Backendless.Messaging.subscribe(channelName);

        rt.addMessageListener(function(message) {
          console.log("üì© Message received:", message);
          window.ReactNativeWebView?.postMessage(message.message);
        });

        rt.on("connect", () => console.log("‚úÖ Connected to channel:", channelName));
        rt.on("disconnect", () => console.log("‚ö†Ô∏è Disconnected from channel"));
        rt.on("fault", (err) => console.error("‚ùå RT fault:", err.message));

      } catch (e) {
        console.error("‚ùå Script error:", e.stack || e.message);
      }
    }

    // Replace with dynamic values in production
    const channelName = "exampleChannel";
    const token = "USER-TOKEN-HERE";

    subscribeToChannel(channelName, token);
  </script>
</body>
</html>
